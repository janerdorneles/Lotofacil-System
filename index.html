<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Inteligente Lotofﾃ｡cil</title>

<style>
body {
  background: #0f172a;
  color: #e5e7eb;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1100px;
  margin: auto;
  padding: 15px;
}

.header {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 10px;
}

.section-title {
  margin-top: 20px;
  font-size: 16px;
  font-weight: bold;
  color: #93c5fd;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px;
}

.btn-modos {
  display: flex;
  gap: 8px;
}

.btn-modo {
  background: #475569;
  color: #e5e7eb;
  border: 1px solid #64748b;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
  white-space: nowrap;
}

.btn-modo:hover {
  background: #64748b;
  transform: translateY(-1px);
}

.btn-modo:active {
  transform: translateY(0);
}

.btn-modo.ativo {
  background: #059669;
  border-color: #10b981;
  box-shadow: 0 0 8px rgba(5, 150, 105, 0.4);
}

.btn-modo.ativo:hover {
  background: #10b981;
}

.contador {
  font-size: 14px;
  color: #facc15;
  font-weight: normal;
}

.contador.completo {
  color: #22c55e;
}

.jogos-title {
  margin-top: 25px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(10, 48px);
  gap: 6px;
  margin-top: 10px;
}

.num {
  background: #1e293b;
  border: 1px solid #334155;
  border-radius: 6px;
  padding: 8px;
  text-align: center;
  cursor: pointer;
  font-size: 15px;
  transition: 0.2s;
  user-select: none;
}

.num:hover {
  background: #2563eb;
  transform: scale(1.05);
}

.num:active {
  transform: scale(0.95);
}

/* 閥 DEZENAS SORTEADAS (VERMELHO) */
.num.sorteado {
  background: #ef4444;
  color: white;
  font-weight: bold;
  border-color: #dc2626;
}

/* 泙 JOGOS (VERDE) */
.num.jogo {
  background: #22c55e;
  color: black;
  font-weight: bold;
  border-color: #16a34a;
}

/* JOGOS */
.jogos-linha {
  display: flex;
  gap: 15px;
  margin-top: 10px;
}

.jogo-box {
  flex: 1;
  border: 1px solid #334155;
  padding: 8px;
  border-radius: 8px;
  background: #111827;
}

.jogo-box h3 {
  margin: 3px 0;
  font-size: 15px;
  color: #facc15;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.jogo-contador {
  font-size: 12px;
  color: #94a3b8;
  font-weight: normal;
}

.jogo-contador.completo {
  color: #22c55e;
}

/* BOTﾃ髭S */
.btn-group {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin: 15px auto;
  flex-wrap: wrap;
}

.btn {
  background: linear-gradient(90deg, #7c3aed, #2563eb);
  color: white;
  border: none;
  padding: 14px 28px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(124,58,237,0.6);
  transition: 0.2s;
}

.btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

.btn:active {
  transform: translateY(0);
}

.btn-secondary {
  background: linear-gradient(90deg, #64748b, #475569);
  box-shadow: 0 0 10px rgba(100,116,139,0.4);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* RESULTADO */
#resultado {
  margin-top: 15px;
  max-width: 800px;
  width: 100%;
  margin: 15px auto;
  background: #020617;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #334155;
}

#resultado.show {
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

td, th {
  border-bottom: 1px solid #334155;
  padding: 8px;
  text-align: left;
}

th {
  background: #1e293b;
  font-weight: bold;
  color: #93c5fd;
}

th:last-child {
  text-align: right;
}

.acerto-premio {
  color: #7dd3fc;
  font-weight: bold;
}

.acerto-15 {
  color: #fbbf24;
  font-weight: bold;
  font-size: 16px;
}

.jogo-vazio {
  color: #64748b;
  font-style: italic;
}

.premio-valor {
  color: #34d399;
  font-weight: bold;
  text-align: right;
}

.premio-zero {
  color: #64748b;
  text-align: right;
}

.total-premios {
  background: #1e293b;
  font-weight: bold;
  color: #fffaf0;
  font-size: 16px;
}

.total-premios .valor-total {
  color: #fbbf24;
}

.total-premios td {
  padding: 12px 8px;
}

footer {
  text-align: center;
  margin-top: 20px;
  font-size: 12px;
  color: #64748b;
}

/* CONCURSO */
.concurso-section {
  background: #111827;
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

.concurso-box {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}

.concurso-box label {
  font-weight: bold;
  color: #93c5fd;
}

.concurso-box select {
  background: #1e293b;
  color: #e5e7eb;
  border: 1px solid #334155;
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 14px;
  cursor: pointer;
  min-width: 200px;
}

.concurso-box select:hover {
  border-color: #2563eb;
}

.concurso-data {
  color: #fb923c; /* Laranja */
  font-weight: bold;
  font-size: 14px;
}

/* MOBILE */
@media (max-width: 768px) {
  .grid {
    grid-template-columns: repeat(5, 1fr);
  }
  .jogos-linha {
    flex-direction: column;
  }
  .btn-group {
    flex-direction: column;
    align-items: stretch;
  }
  .btn {
    width: 100%;
  }
  .section-title {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
  }
}

/* Toast de notificaﾃｧﾃ｣o */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #1e293b;
  color: #e5e7eb;
  padding: 12px 24px;
  border-radius: 8px;
  border: 1px solid #334155;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  z-index: 1000;
  animation: toastIn 0.3s ease-out;
}

.toast.saindo {
  animation: toastOut 0.3s ease-out forwards;
}

@keyframes toastIn {
  from {
    opacity: 0;
    transform: translate(-50%, 20px);
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0);
  }
}

@keyframes toastOut {
  from {
    opacity: 1;
    transform: translate(-50%, 0);
  }
  to {
    opacity: 0;
    transform: translate(-50%, 20px);
  }
}
</style>
</head>

<body>
<div class="container">

<div class="header">識 Conferﾃｪncia Automﾃ｡tica Lotofﾃ｡cil</div>

<!-- SELEﾃﾃグ DE CONCURSO -->
<div class="concurso-section">
  <div class="section-title">
    <span>軸 Selecione o Concurso</span>
    <div class="btn-modos">
      <button id="btnModoOffline" class="btn-modo" onclick="forcarModoOffline()" title="Ativar modo offline para seleﾃｧﾃ｣o manual">
        洞 Modo Offline
      </button>
      <button id="btnModoOnline" class="btn-modo" onclick="forcarModoOnline()" title="Recarregar concursos da API">
        倹 Modo Online
      </button>
    </div>
  </div>
  <div class="concurso-box">
    <label for="selectConcurso">Concurso:</label>
    <select id="selectConcurso" onchange="carregarConcurso()">
      <option value="">Carregando concursos...</option>
    </select>
    <span class="concurso-data" id="concursoData"></span>
  </div>
</div>

<div class="section-title">
  <span>Dezenas Sorteadas (selecione 15)</span>
  <span class="contador" id="contadorSorteio">0/15</span>
</div>
<div id="gridSorteio" class="grid"></div>

<div class="section-title jogos-title">
  <span>Seus Jogos</span>
</div>

<div class="jogos-linha">
  <div class="jogo-box">
    <h3>
      <span>Jogo 1</span>
      <span class="jogo-contador" id="contadorJ1">0/15</span>
    </h3>
    <div id="gridJ1" class="grid"></div>
  </div>

  <div class="jogo-box">
    <h3>
      <span>Jogo 2</span>
      <span class="jogo-contador" id="contadorJ2">0/15</span>
    </h3>
    <div id="gridJ2" class="grid"></div>
  </div>
</div>

<div class="jogos-linha">
  <div class="jogo-box">
    <h3>
      <span>Jogo 3</span>
      <span class="jogo-contador" id="contadorJ3">0/15</span>
    </h3>
    <div id="gridJ3" class="grid"></div>
  </div>

  <div class="jogo-box">
    <h3>
      <span>Jogo 4</span>
      <span class="jogo-contador" id="contadorJ4">0/15</span>
    </h3>
    <div id="gridJ4" class="grid"></div>
  </div>
</div>

<div class="btn-group">
  <button class="btn" onclick="conferir()">Conferir Jogos</button>
  <button class="btn btn-secondary" onclick="limparTudo()">Limpar Tudo</button>
</div>

<div id="resultado"></div>

<footer>Desenvolvido por Janer Dorneles 窶｢ Lotofﾃ｡cil Checker</footer>

</div>

<script>
/* ============================================
   CONSTANTES E CONFIGURAﾃﾃグ
============================================ */
const CONFIG = {
  MAX_NUMEROS: 15,
  TOTAL_NUMEROS: 25,
  QUANTIDADE_CONCURSOS: 15, // Quantidade de concursos a buscar da API
  API_URL: 'https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil',
  TOAST_DURATION: 2000,
  STORAGE_KEY: 'lotofacilData'
};

/* ESTADO GLOBAL */
let concursos = [];
let toastAtual = null; // OTIMIZAﾃﾃグ: controle de toast ﾃｺnico

/* ============================================
   UTILITﾃヽIOS
============================================ */

// OTIMIZAﾃﾃグ: Cache de elementos DOM
const elementos = {};
const getElemento = (id) => {
  if (!elementos[id]) {
    elementos[id] = document.getElementById(id);
  }
  return elementos[id];
};

// OTIMIZAﾃﾃグ: Funﾃｧﾃ｣o de formataﾃｧﾃ｣o centralizada
const formatarNumero = (num) => String(num).padStart(2, '0');

// OTIMIZAﾃﾃグ: Funﾃｧﾃ｣o de formataﾃｧﾃ｣o de moeda reutilizﾃ｡vel
const formatarMoeda = (valor) => valor.toLocaleString('pt-BR', {
  minimumFractionDigits: 2,
  maximumFractionDigits: 2
});

/* ============================================
   API - BUSCAR CONCURSOS
============================================ */
async function buscarUltimosConcursos() {
  // Verificar se estﾃ｡ online ANTES de tentar buscar
  if (!navigator.onLine) {
    mostrarModoOffline();
    return;
  }
  
  try {
    // OTIMIZAﾃﾃグ: Buscar o ﾃｺltimo concurso com timeout de 10 segundos
    const controlador = new AbortController();
    const timeoutId = setTimeout(() => controlador.abort(), 10000);
    
    const responseUltimo = await fetch(CONFIG.API_URL, {
      cache: 'no-store',
      signal: controlador.signal
    });
    
    clearTimeout(timeoutId);
    
    if (!responseUltimo.ok) {
      throw new Error('Erro na API');
    }
    
    const ultimoConcurso = await responseUltimo.json();
    const numeroUltimo = ultimoConcurso.numero;
    
    // OTIMIZAﾃﾃグ: Buscar todos em paralelo com Promise.all (muito mais rﾃ｡pido!)
    const promises = [];
    for (let i = 0; i < CONFIG.QUANTIDADE_CONCURSOS; i++) {
      const numConcurso = numeroUltimo - i;
      promises.push(
        fetch(`${CONFIG.API_URL}/${numConcurso}`, { cache: 'no-store' })
          .then(r => r.ok ? r.json() : null)
          .catch(() => null)
      );
    }
    
    const resultados = await Promise.all(promises);
    
    concursos = resultados
      .filter(dados => dados && dados.numero && dados.listaDezenas)
      .map(dados => ({
        numero: dados.numero,
        data: dados.dataApuracao,
        dezenas: dados.listaDezenas.map(d => parseInt(d)).sort((a, b) => a - b)
      }));
    
    if (concursos.length === 0) {
      throw new Error('Nenhum concurso carregado');
    }
    
    popularConcursos();
    alternarModo(true);
    
  } catch (error) {
    console.error('Erro ao buscar concursos:', error);
    mostrarModoOffline();
  }
}

/* ============================================
   MODO ONLINE/OFFLINE
============================================ */

// OTIMIZAﾃﾃグ: Funﾃｧﾃ｣o unificada para alternar modo (substitui ativarBotaoOffline e ativarBotaoOnline)
function alternarModo(online) {
  const btnOnline = getElemento('btnModoOnline');
  const btnOffline = getElemento('btnModoOffline');
  
  if (online) {
    btnOnline.classList.add('ativo');
    btnOffline.classList.remove('ativo');
  } else {
    btnOnline.classList.remove('ativo');
    btnOffline.classList.add('ativo');
  }
}

function mostrarModoOffline() {
  const select = getElemento('selectConcurso');
  select.innerHTML = '<option value="">洞 Offline: Informe as dezenas manualmente</option>';
  select.disabled = true;
  select.style.cursor = 'not-allowed';
  
  const dataElement = getElemento('concursoData');
  dataElement.innerHTML = '<span style="color: #ef4444;">Sem conexﾃ｣o</span>';
  
  alternarModo(false);
}

function forcarModoOffline() {
  if(confirm('Ativar modo offline? Isso limparﾃ｡ a lista de concursos e vocﾃｪ deverﾃ｡ selecionar as dezenas manualmente.')) {
    mostrarModoOffline();
    limparSorteio();
    mostrarToast('Modo offline ativado. Selecione as dezenas manualmente.');
  }
}

async function forcarModoOnline() {
  if(confirm('Recarregar concursos da API? Isso irﾃ｡ buscar os ﾃｺltimos concursos disponﾃｭveis.')) {
    const select = getElemento('selectConcurso');
    select.innerHTML = '<option value="">Carregando concursos...</option>';
    select.disabled = false;
    select.style.cursor = 'default';
    
    getElemento('concursoData').textContent = '';
    limparSorteio();
    
    alternarModo(true); // OTIMIZAﾃﾃグ: Usar funﾃｧﾃ｣o unificada
    
    mostrarToast('Buscando concursos...');
    await buscarUltimosConcursos();
    
    if(concursos.length > 0) {
      mostrarToast('Concursos carregados com sucesso!');
    }
  }
}

/* ============================================
   CONCURSOS
============================================ */

function popularConcursos() {
  const select = getElemento('selectConcurso');
  select.innerHTML = '<option value="">Selecione...</option>';
  
  // OTIMIZAﾃﾃグ: usar DocumentFragment para adicionar mﾃｺltiplos elementos de uma vez
  const fragment = document.createDocumentFragment();
  concursos.forEach(c => {
    const option = document.createElement('option');
    option.value = c.numero;
    option.textContent = c.numero;
    option.dataset.data = c.data;
    fragment.appendChild(option);
  });
  select.appendChild(fragment);
}

function carregarConcurso() {
  const select = getElemento('selectConcurso');
  const concursoNum = select.value;
  
  if (!concursoNum) {
    getElemento('concursoData').textContent = '';
    limparSorteio();
    return;
  }
  
  const concurso = concursos.find(c => c.numero == concursoNum);
  if (!concurso) return;
  
  getElemento('concursoData').textContent = concurso.data;
  
  limparSorteio();
  
  // OTIMIZAﾃﾃグ: Usar children[index] ﾃｩ mais rﾃ｡pido que querySelector
  concurso.dezenas.forEach(num => {
    sorteioSet.add(num);
    const elem = getElemento('gridSorteio').children[num - 1];
    if (elem) {
      elem.classList.add('sorteado');
      elem.setAttribute('aria-pressed', 'true');
    }
  });
  
  atualizarContador('Sorteio', sorteioSet);
  salvarEstado();
}

function limparSorteio() {
  sorteioSet.clear();
  Array.from(getElemento('gridSorteio').children).forEach(num => {
    num.classList.remove('sorteado');
    num.setAttribute('aria-pressed', 'false');
  });
  atualizarContador('Sorteio', sorteioSet);
}

/* ============================================
   CONTADORES
============================================ */

function atualizarContador(id, set, maxNumeros = CONFIG.MAX_NUMEROS) {
  const contador = getElemento(`contador${id}`);
  if (!contador) return;
  
  const qtd = set.size;
  contador.textContent = `${qtd}/${maxNumeros}`;
  
  // OTIMIZAﾃﾃグ: toggle simplificado
  contador.classList.toggle('completo', qtd === maxNumeros);
}

/* ============================================
   TOAST (OTIMIZADO)
============================================ */

function mostrarToast(mensagem) {
  // OTIMIZAﾃﾃグ: Remover toast anterior se existir (evita mﾃｺltiplos toasts)
  if (toastAtual) {
    toastAtual.remove();
  }
  
  toastAtual = document.createElement('div');
  toastAtual.className = 'toast';
  toastAtual.textContent = mensagem;
  document.body.appendChild(toastAtual);
  
  setTimeout(() => {
    toastAtual.classList.add('saindo');
    setTimeout(() => {
      if (toastAtual) {
        toastAtual.remove();
        toastAtual = null;
      }
    }, 300);
  }, CONFIG.TOAST_DURATION);
}

/* ============================================
   CRIAR GRADES (OTIMIZADO)
============================================ */

function criarGrade(id, contadorId = null){
  let grid = getElemento(id);
  let set = new Set();
  let frag = document.createDocumentFragment();
  const isSorteio = id === 'gridSorteio';

  for(let i=1;i<=CONFIG.TOTAL_NUMEROS;i++){
    let d = document.createElement("div");
    d.className = "num";
    d.innerText = formatarNumero(i);
    d.setAttribute('role', 'button');
    d.setAttribute('aria-label', `Nﾃｺmero ${i}`);
    d.setAttribute('tabindex', '0');

    const toggleNumero = () => {
      if(set.has(i)){
        set.delete(i);
        d.classList.remove("sorteado", "jogo");
        d.setAttribute('aria-pressed', 'false');
      } 
      else {
        if(set.size >= CONFIG.MAX_NUMEROS) {
          mostrarToast(`Mﾃ｡ximo de ${CONFIG.MAX_NUMEROS} nﾃｺmeros atingido`);
          return;
        }
        set.add(i);
        d.setAttribute('aria-pressed', 'true');
        d.classList.add(isSorteio ? "sorteado" : "jogo");
      }
      
      if(contadorId) {
        atualizarContador(contadorId, set);
      }
      
      // Salvar no localStorage
      salvarEstado();
    };

    d.onclick = toggleNumero;
    
    // Acessibilidade: suporte a teclado
    d.onkeydown = (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleNumero();
      }
    };

    frag.appendChild(d);
  }

  grid.appendChild(frag);
  return set;
}

let sorteioSet = criarGrade("gridSorteio", "Sorteio");
let jogo1 = criarGrade("gridJ1", "J1");
let jogo2 = criarGrade("gridJ2", "J2");
let jogo3 = criarGrade("gridJ3", "J3");
let jogo4 = criarGrade("gridJ4", "J4");

/* ============================================
   LIMPAR TUDO
============================================ */

function limparTudo() {
  if(!confirm('Deseja realmente limpar todas as seleﾃｧﾃｵes?')) return;
  
  getElemento('selectConcurso').value = '';
  getElemento('concursoData').textContent = '';
  
  [sorteioSet, jogo1, jogo2, jogo3, jogo4].forEach(set => set.clear());
  
  // OTIMIZAﾃﾃグ: Limpar usando referﾃｪncias ﾃs grades em vez de querySelectorAll
  const grids = ['gridSorteio', 'gridJ1', 'gridJ2', 'gridJ3', 'gridJ4'];
  grids.forEach(id => {
    const grid = getElemento(id);
    Array.from(grid.children).forEach(num => {
      num.classList.remove('sorteado', 'jogo');
      num.setAttribute('aria-pressed', 'false');
    });
  });
  
  atualizarContador('Sorteio', sorteioSet);
  atualizarContador('J1', jogo1);
  atualizarContador('J2', jogo2);
  atualizarContador('J3', jogo3);
  atualizarContador('J4', jogo4);
  
  getElemento('resultado').innerHTML = '';
  localStorage.removeItem(CONFIG.STORAGE_KEY);
  mostrarToast('Todas as seleﾃｧﾃｵes foram limpas');
}

/* ============================================
   CONFERIR
============================================ */

async function conferir(){
  if(sorteioSet.size !== CONFIG.MAX_NUMEROS){
    mostrarToast('Selecione exatamente 15 dezenas sorteadas!');
    return;
  }

  let jogos = [
    {nome:"Jogo 1", set:jogo1},
    {nome:"Jogo 2", set:jogo2},
    {nome:"Jogo 3", set:jogo3},
    {nome:"Jogo 4", set:jogo4}
  ];

  const temJogos = jogos.some(j => j.set.size > 0);
  if(!temJogos) {
    mostrarToast('Preencha pelo menos um jogo para conferir');
    return;
  }

  // Buscar dados do prﾃｪmio da API
  let premios = {};
  let dadosPremio15 = { ganhadores: 0, valorPorGanhador: 0 };
  const concursoNum = getElemento('selectConcurso').value;
  let modoOffline = !concursoNum; // Se nﾃ｣o tem concurso selecionado, estﾃ｡ offline
  
  if(concursoNum) {
    try {
      const response = await fetch(`https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil/${concursoNum}`);
      if(response.ok) {
        const data = await response.json();
        // Extrair valores dos prﾃｪmios por faixa
        if(data.listaRateioPremio) {
          data.listaRateioPremio.forEach(faixa => {
            premios[faixa.faixa] = faixa.valorPremio;
            // Capturar dados da faixa 1 (15 acertos)
            if(faixa.faixa === 1) {
              dadosPremio15.ganhadores = faixa.numeroDeGanhadores || 0;
              dadosPremio15.valorPorGanhador = faixa.valorPremio || 0;
            }
          });
        }
      }
    } catch(e) {
      console.log('Nﾃ｣o foi possﾃｭvel buscar prﾃｪmios da API');
    }
  }

  let html = "<table><tr><th>Jogo</th><th>Dezenas Acertadas</th><th>Acertos</th><th>Prﾃｪmio</th></tr>";
  let totalPremios = 0;

  jogos.forEach(j => {
    if(j.set.size === 0) {
      html += `<tr>
        <td>${j.nome}</td>
        <td class="jogo-vazio" colspan="3">Jogo nﾃ｣o preenchido</td>
      </tr>`;
      return;
    }

    // OTIMIZAﾃﾃグ: Filtrar acertos de forma mais eficiente
    const acertos = [];
    for(const num of j.set) {
      if(sorteioSet.has(num)) acertos.push(num);
    }
    acertos.sort((a,b) => a-b);
    
    const qtd = acertos.length;

    let classe = "";
    if(qtd === 15) classe = "acerto-15";
    else if(qtd >= 11) classe = "acerto-premio";

    let emoji = "";
    if(qtd === 15) emoji = " 醇";
    else if(qtd >= 14) emoji = " 脂";
    else if(qtd >= 11) emoji = " 笨";

    // Determinar valor do prﾃｪmio
    let valorPremio = 0;
    let classeValor = "premio-zero";
    let textoValor = "";
    
    // Se estiver em modo offline, exibir "Offline" para todos os jogos
    if(modoOffline) {
      textoValor = "Offline";
      classeValor = "premio-zero";
    } else {
      if(qtd >= 11) {
        // Faixa 1 = 15 acertos, Faixa 2 = 14 acertos, Faixa 3 = 13 acertos, etc.
        const faixa = 16 - qtd; // 15->1, 14->2, 13->3, 12->4, 11->5
        valorPremio = premios[faixa] || 0;
        
        if(valorPremio > 0) {
          totalPremios += valorPremio;
          classeValor = "premio-valor";
        }
      }
      
      // OTIMIZAﾃﾃグ: Usar funﾃｧﾃ｣o formatarMoeda reutilizﾃ｡vel
      const valorFormatado = formatarMoeda(valorPremio);
      textoValor = `R$ ${valorFormatado}`;
    }

    html += `<tr>
      <td><strong>${j.nome}</strong></td>
      <td>${acertos.length > 0 ? acertos.map(formatarNumero).join(", ") : '-'}</td>
      <td class="${classe}">${qtd} acertos${emoji}</td>
      <td class="${classeValor}">${textoValor}</td>
    </tr>`;
  });

  // Adicionar linha de total
  if(modoOffline) {
    html += `<tr class="total-premios">
      <td colspan="3" style="text-align: right;">Total do(s) prﾃｪmio(s):</td>
      <td class="valor-total" style="text-align: right;">Offline</td>
    </tr>`;
  } else {
    // OTIMIZAﾃﾃグ: Usar funﾃｧﾃ｣o formatarMoeda reutilizﾃ｡vel
    const totalFormatado = formatarMoeda(totalPremios);
    
    let textoPremio15 = "";
    if(dadosPremio15.ganhadores === 0 || dadosPremio15.valorPorGanhador === 0) {
      textoPremio15 = "Acumulado";
    } else {
      const ganhadoresFormatado = dadosPremio15.ganhadores.toLocaleString('pt-BR');
      const valorGanhadorFormatado = formatarMoeda(dadosPremio15.valorPorGanhador);
      textoPremio15 = `${ganhadoresFormatado} aposta${dadosPremio15.ganhadores !== 1 ? 's' : ''} ganhadora${dadosPremio15.ganhadores !== 1 ? 's' : ''}, R$ ${valorGanhadorFormatado}`;
    }
    
    html += `<tr class="total-premios">
      <td colspan="2" style="text-align: left; color: #fffaf0; font-size: 13px;">
        <strong>Premiaﾃｧﾃ｣o 15 acertos:</strong> ${textoPremio15}
      </td>
      <td style="text-align: right;">Total do(s) prﾃｪmio(s):</td>
      <td class="valor-total" style="text-align: right;">R$ ${totalFormatado}</td>
    </tr>`;
  }

  html += "</table>";
  
  const resultado = getElemento("resultado");
  resultado.innerHTML = html;
  resultado.classList.add('show');
  resultado.scrollIntoView({behavior:"smooth"});
}

/* ============================================
   PERSISTﾃ劾CIA
============================================ */

function salvarEstado() {
  const estado = {
    concurso: getElemento('selectConcurso').value,
    sorteio: [...sorteioSet],
    jogo1: [...jogo1],
    jogo2: [...jogo2],
    jogo3: [...jogo3],
    jogo4: [...jogo4]
  };
  localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(estado));
}

function carregarEstado() {
  const data = localStorage.getItem(CONFIG.STORAGE_KEY);
  if(!data) return;
  
  try {
    const estado = JSON.parse(data);
    
    if(estado.concurso) {
      getElemento('selectConcurso').value = estado.concurso;
      carregarConcurso();
      return;
    }
    
    // OTIMIZAﾃﾃグ: Funﾃｧﾃ｣o helper para evitar repetiﾃｧﾃ｣o
    const restaurarSet = (set, numeros, gridId, classe) => {
      const grid = getElemento(gridId);
      numeros.forEach(num => {
        set.add(num);
        const elem = grid.children[num - 1];
        if(elem) {
          elem.classList.add(classe);
          elem.setAttribute('aria-pressed', 'true');
        }
      });
    };
    
    restaurarSet(sorteioSet, estado.sorteio, 'gridSorteio', 'sorteado');
    restaurarSet(jogo1, estado.jogo1, 'gridJ1', 'jogo');
    restaurarSet(jogo2, estado.jogo2, 'gridJ2', 'jogo');
    restaurarSet(jogo3, estado.jogo3, 'gridJ3', 'jogo');
    restaurarSet(jogo4, estado.jogo4, 'gridJ4', 'jogo');
    
    atualizarContador('Sorteio', sorteioSet);
    atualizarContador('J1', jogo1);
    atualizarContador('J2', jogo2);
    atualizarContador('J3', jogo3);
    atualizarContador('J4', jogo4);
    
  } catch(e) {
    console.error('Erro ao carregar dados salvos:', e);
  }
}

/* ============================================
   INICIALIZAﾃﾃグ E EVENTOS
============================================ */
window.addEventListener('DOMContentLoaded', async () => {
  await buscarUltimosConcursos();
  carregarEstado();
});

// OTIMIZAﾃﾃグ: Nﾃ｣o recarrega a pﾃ｡gina ao voltar online (mantﾃｩm estado do usuﾃ｡rio)
window.addEventListener('online', async () => {
  console.log('Voltou online - recarregando concursos...');
  mostrarToast('Conexﾃ｣o restabelecida! Recarregando concursos...');
  await buscarUltimosConcursos();
});

window.addEventListener('offline', () => {
  console.log('Ficou offline');
  mostrarModoOffline();
  mostrarToast('Vocﾃｪ estﾃ｡ offline. Selecione as dezenas manualmente.');
});
</script>

</body>
</html>
